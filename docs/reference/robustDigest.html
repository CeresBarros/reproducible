<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create reproducible digests of objects in R — .robustDigest â€¢ reproducible</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Google analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58633549-5', 'auto');
  ga('send', 'pageview');

</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">reproducible</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PredictiveEcology/reproducible">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create reproducible digests of objects in R</h1>
    </div>

    
    <p>Not all aspects of R objects are captured by current hashing tools in R (e.g.
<code><a href='http://www.rdocumentation.org/packages/digest/topics/digest'>digest::digest</a></code>, <code><a href='http://www.rdocumentation.org/packages/fastdigest/topics/fastdigest'>fastdigest::fastdigest</a></code>, <code>knitr</code> caching,
<code><a href='http://www.rdocumentation.org/packages/archivist/topics/cache'>archivist::cache</a></code>). This is mostly because many objects have "transient"
(e.g., functions have environments), or "disk-backed" features. This function
allows for these accommodations to be made and uses <code><a href='http://www.rdocumentation.org/packages/fastdigest/topics/fastdigest'>fastdigest</a></code>
internally.  Since
the goal of using reproducibility is to have tools that are not session specific,
this function
attempts to strip all session specific information so that the fastdigest
works between sessions and operating systems. It is tested under many
conditions and object types, there are bound to be others that don't
work correctly.</p>
    

    <pre class="usage"><span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>objects</span>, <span class='kw'>compareRasterFileLength</span> <span class='kw'>=</span> <span class='fl'>1e+06</span>,
  <span class='kw'>algo</span> <span class='kw'>=</span> <span class='st'>"xxhash64"</span>, <span class='kw'>digestPathContent</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>classOptions</span> <span class='kw'>=</span> <span class='fu'>list</span>())

<span class='co'># S4 method for ANY</span>
<span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>compareRasterFileLength</span>, <span class='no'>algo</span>,
  <span class='no'>digestPathContent</span>, <span class='no'>classOptions</span>)

<span class='co'># S4 method for cluster</span>
<span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>compareRasterFileLength</span>, <span class='no'>algo</span>,
  <span class='no'>digestPathContent</span>, <span class='no'>classOptions</span>)

<span class='co'># S4 method for `function`</span>
<span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>compareRasterFileLength</span>, <span class='no'>algo</span>,
  <span class='no'>digestPathContent</span>, <span class='no'>classOptions</span>)

<span class='co'># S4 method for expression</span>
<span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>compareRasterFileLength</span>, <span class='no'>algo</span>,
  <span class='no'>digestPathContent</span>, <span class='no'>classOptions</span>)

<span class='co'># S4 method for character</span>
<span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>compareRasterFileLength</span>, <span class='no'>algo</span>,
  <span class='no'>digestPathContent</span>, <span class='no'>classOptions</span>)

<span class='co'># S4 method for Path</span>
<span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>compareRasterFileLength</span>, <span class='no'>algo</span>,
  <span class='no'>digestPathContent</span>, <span class='no'>classOptions</span>)

<span class='co'># S4 method for environment</span>
<span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>compareRasterFileLength</span>, <span class='no'>algo</span>,
  <span class='no'>digestPathContent</span>, <span class='no'>classOptions</span>)

<span class='co'># S4 method for list</span>
<span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>compareRasterFileLength</span>, <span class='no'>algo</span>,
  <span class='no'>digestPathContent</span>, <span class='no'>classOptions</span>)

<span class='co'># S4 method for Raster</span>
<span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>compareRasterFileLength</span>, <span class='no'>algo</span>,
  <span class='no'>digestPathContent</span>, <span class='no'>classOptions</span>)

<span class='co'># S4 method for Spatial</span>
<span class='fu'>.robustDigest</span>(<span class='no'>object</span>, <span class='no'>compareRasterFileLength</span>, <span class='no'>algo</span>,
  <span class='no'>digestPathContent</span>, <span class='no'>classOptions</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>an object to digest.</p></td>
    </tr>
    <tr>
      <th>objects</th>
      <td><p>Optional character vector indicating which objects are to
be considered while making digestible. This is only relevant
if the object being passed is an environment or list or the like.</p></td>
    </tr>
    <tr>
      <th>compareRasterFileLength</th>
      <td><p>Numeric. Optional. When there are Rasters, that
have file-backed storage, this is passed to the length arg in <code>digest</code>
when determining if the Raster file is already in the database.
Note: uses <code><a href='http://www.rdocumentation.org/packages/digest/topics/digest'>digest</a></code> for file-backed Raster.
Default 1e6. Passed to <code>.prepareFileBackedRaster</code>.</p></td>
    </tr>
    <tr>
      <th>algo</th>
      <td><p>The algorithms to be used; currently available choices are
    <code>md5</code>, which is also the default, <code>sha1</code>, <code>crc32</code>,
    <code>sha256</code>, <code>sha512</code>, <code>xxhash32</code>, <code>xxhash64</code> and
    <code>murmur32</code>.</p></td>
    </tr>
    <tr>
      <th>digestPathContent</th>
      <td><p>Logical. Should arguments that are of class <code>Path</code>
(see examples below) have their name digested
(<code>FALSE</code>), or their file contents (<code>TRUE</code>; default).</p></td>
    </tr>
    <tr>
      <th>classOptions</th>
      <td><p>Optional list. This will pass into <code>.robustDigest</code> for
specific classes. Should be options that the <code>.robustDigest</code> knows what
to do with.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A hash i.e., digest of the object passed in.</p>
    
    <h2 class="hasAnchor" id="classes"><a class="anchor" href="#classes"></a>Classes</h2>

    
    <p><code>Raster*</code> objects have the potential for disk-backed storage.
If the object in the R session is cached using <code><a href='http://www.rdocumentation.org/packages/archivist/topics/cache'>archivist::cache</a></code>, only
the header component will be assessed for caching. Thus, objects like this
require more work. Also, because <code>Raster*</code> can have a built-in representation
for having their data content located on disk, this format will be maintained if the
raster already is file-backed, i.e., to create <code>.tif</code> or <code>.grd</code> backed rasters,
use <code>writeRaster</code> first, then Cache. The .tif or .grd will be copied to the "raster"
subdirectory of the <code>cacheRepo</code>.
Their RAM representation (as an R object) will still be in the usual <code class="file">gallery/</code> directory.
For <code>inMemory</code> raster objects, they will remain as binary <code>.RData</code> files.</p>
<p>Functions (which are contained within environments) are
converted to a text representation via a call to <code>format(FUN)</code>.</p>
<p>Objects contained within a list or environment are recursively hashed
using <code><a href='http://www.rdocumentation.org/packages/fastdigest/topics/fastdigest'>fastdigest</a></code>, while removing all references to
environments.</p>
<p>Character strings are first assessed with <code>dir.exists</code> and <code>file.exists</code>
to check for paths. If they are found to be paths, then the path is hashed with
only its filename via <code>basename(filename)</code>. If it is actually a path, we suggest
using <code>asPath(thePath)</code></p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='http://www.rdocumentation.org/packages/archivist/topics/cache'>cache</a></code>.
    <code><a href='http://www.rdocumentation.org/packages/fastdigest/topics/fastdigest'>fastdigest</a></code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span>
<span class='no'>tmpfile1</span> <span class='kw'>&lt;-</span> <span class='fu'>tempfile</span>()
<span class='no'>tmpfile2</span> <span class='kw'>&lt;-</span> <span class='fu'>tempfile</span>()
<span class='fu'>save</span>(<span class='no'>a</span>, <span class='kw'>file</span> <span class='kw'>=</span> <span class='no'>tmpfile1</span>)
<span class='fu'>save</span>(<span class='no'>a</span>, <span class='kw'>file</span> <span class='kw'>=</span> <span class='no'>tmpfile2</span>)

<span class='co'># treats as character string, so 2 filenames are different</span>
<span class='kw pkg'>fastdigest</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/fastdigest/topics/fastdigest'>fastdigest</a></span>(<span class='no'>tmpfile1</span>)</div><div class='output co'>#&gt; [1] "7616b3f08f75b8e46b6e6e5099259606"</div><div class='input'><span class='kw pkg'>fastdigest</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/fastdigest/topics/fastdigest'>fastdigest</a></span>(<span class='no'>tmpfile2</span>)</div><div class='output co'>#&gt; [1] "558ca583c69b03f52a3e3a8d875fbbd2"</div><div class='input'>
<span class='co'># tests to see whether character string is representing a file</span>
<span class='fu'>.robustDigest</span>(<span class='no'>tmpfile1</span>)</div><div class='output co'>#&gt; [1] "46016fc41d2dbcf4"</div><div class='input'><span class='fu'>.robustDigest</span>(<span class='no'>tmpfile2</span>) <span class='co'># same</span></div><div class='output co'>#&gt; [1] "46016fc41d2dbcf4"</div><div class='input'>
<span class='co'># if you tell it that it is a path, then you can decide if you want it to be</span>
<span class='co'>#  treated as a character string or as a file path</span>
<span class='fu'>.robustDigest</span>(<span class='fu'>asPath</span>(<span class='no'>tmpfile1</span>))</div><div class='output co'>#&gt; [1] "8345cbf07267dee5f8f511ec20c8a062"</div><div class='input'><span class='fu'>.robustDigest</span>(<span class='fu'>asPath</span>(<span class='no'>tmpfile2</span>)) <span class='co'># different because you have a choice</span></div><div class='output co'>#&gt; [1] "2ffbd2f505cc7de0b64ce2c9895d2c21"</div><div class='input'>
<span class='fu'>.robustDigest</span>(<span class='fu'>asPath</span>(<span class='no'>tmpfile1</span>), <span class='kw'>digestPathContent</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; [[1]]
#&gt; [1] "46016fc41d2dbcf4"
#&gt; </div><div class='input'><span class='fu'>.robustDigest</span>(<span class='fu'>asPath</span>(<span class='no'>tmpfile2</span>), <span class='kw'>digestPathContent</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>) <span class='co'># same</span></div><div class='output co'>#&gt; [[1]]
#&gt; [1] "46016fc41d2dbcf4"
#&gt; </div><div class='input'>
<span class='co'># Rasters are interesting because it is not know a priori if it</span>
<span class='co'>#   it has a file name associated with it.</span>
<span class='fu'>library</span>(<span class='no'>raster</span>)
<span class='no'>r</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/raster'>raster</a></span>(<span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/extent'>extent</a></span>(<span class='fl'>0</span>,<span class='fl'>10</span>,<span class='fl'>0</span>,<span class='fl'>10</span>), <span class='kw'>vals</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>100</span>)

<span class='co'># write to disk</span>
<span class='no'>r1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/writeRaster'>writeRaster</a></span>(<span class='no'>r</span>, <span class='kw'>file</span> <span class='kw'>=</span> <span class='no'>tmpfile1</span>)
<span class='no'>r2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/writeRaster'>writeRaster</a></span>(<span class='no'>r</span>, <span class='kw'>file</span> <span class='kw'>=</span> <span class='no'>tmpfile2</span>)

<span class='kw pkg'>digest</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/digest/topics/digest'>digest</a></span>(<span class='no'>r1</span>)</div><div class='output co'>#&gt; [1] "ad819d19cbb8edf7d40b659108a7a00a"</div><div class='input'><span class='kw pkg'>digest</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/digest/topics/digest'>digest</a></span>(<span class='no'>r2</span>) <span class='co'># different</span></div><div class='output co'>#&gt; [1] "79e6cb8ed6625234805ba9d7de899215"</div><div class='input'><span class='kw pkg'>fastdigest</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/fastdigest/topics/fastdigest'>fastdigest</a></span>(<span class='no'>r1</span>)</div><div class='output co'>#&gt; [1] "f9b841727bfd42ae83d53fdfd1273e71"</div><div class='input'><span class='kw pkg'>fastdigest</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/fastdigest/topics/fastdigest'>fastdigest</a></span>(<span class='no'>r2</span>) <span class='co'># different</span></div><div class='output co'>#&gt; [1] "4971a320b754b8efb35077eddf602ef4"</div><div class='input'><span class='fu'>.robustDigest</span>(<span class='no'>r1</span>)</div><div class='output co'>#&gt; [1] "79317ebbbb2d0e6b05fa1e968b9f5880"</div><div class='input'><span class='fu'>.robustDigest</span>(<span class='no'>r2</span>) <span class='co'># same... data are the same in the file</span></div><div class='output co'>#&gt; [1] "79317ebbbb2d0e6b05fa1e968b9f5880"</div><div class='input'>
<span class='co'># note, this is not true for comparing memory and file-backed rasters</span>
<span class='fu'>.robustDigest</span>(<span class='no'>r</span>)</div><div class='output co'>#&gt; [1] "36cb66a1b7fedc105c3b25649645ae91"</div><div class='input'><span class='fu'>.robustDigest</span>(<span class='no'>r1</span>) <span class='co'># different</span></div><div class='output co'>#&gt; [1] "79317ebbbb2d0e6b05fa1e968b9f5880"</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#classes">Classes</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Eliot McIntire

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Eliot J B McIntire, Alex M Chubaty.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
